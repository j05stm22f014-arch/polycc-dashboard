<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PolyCC Interactive Dashboard</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    margin: 0;
    background-color: #f4f6fa;
    color: #333;
  }

  header {
    background-color: #00539C;
    color: white;
    text-align: center;
    padding: 20px;
    font-size: 22px;
    font-weight: bold;
  }

  nav {
    display: flex;
    justify-content: center;
    background-color: #e5e5e5;
  }

  nav button {
    background: none;
    border: none;
    padding: 15px 25px;
    cursor: pointer;
    font-size: 16px;
    color: #333;
    font-weight: 600;
  }

  nav button.active {
    background-color: #00539C;
    color: white;
    border-radius: 5px 5px 0 0;
  }

  .container {
    margin: 20px auto;
    max-width: 1100px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    padding: 20px;
  }

  #chart1, #chart2, #chart3 {
    width: 100%;
    height: 600px;
    display: none;
  }

  #chart1.active, #chart2.active, #chart3.active {
    display: block;
  }

  footer {
    text-align: center;
    padding: 15px;
    color: #777;
    font-size: 13px;
  }

  .stats-box {
    margin-top: 15px;
    background: #f9fafc;
    border: 1px solid #ddd;
    padding: 10px;
    border-radius: 8px;
    line-height: 1.7;
  }

  .highlight {
    font-weight: bold;
    color: #00539C;
  }
</style>
</head>
<body>

<header>PolyCC Dashboard – Enrollment & Employability (2020–2024)</header>

<nav>
  <button class="active" onclick="showChart(1)">📊 Bubble Chart</button>
  <button onclick="showChart(2)">📉 Best & Worst Courses</button>
  <button onclick="showChart(3)">📈 Overview Summary</button>
</nav>

<div class="container">
  <div id="chart1" class="active"></div>
  <div id="chart2"></div>
  <div id="chart3"></div>

  <div class="stats-box" id="stats"></div>
</div>

<footer>Created by Iskandar R. | Powered by Plotly.js</footer>

<script>
function showChart(num) {
  document.querySelectorAll('nav button').forEach((b, i) => {
    b.classList.toggle('active', i === num - 1);
  });
  document.querySelectorAll('.container > div').forEach((div, i) => {
    div.classList.toggle('active', i === num - 1);
  });
}

Plotly.d3.csv("merged_data.csv", function(data) {
  if (!data.length) {
    document.getElementById("stats").innerHTML = "⚠️ No data found in merged_data.csv";
    return;
  }

  // Convert numeric fields
  data.forEach(d => {
    d["Average Enrollment"] = parseFloat(d["Average Enrollment"]);
    d["Average Employability"] = parseFloat(d["Average Employability"]);
  });

  // === 1️⃣ Bubble Chart (Colored by Year) ===
  // Simulate years if not present
  const years = [2020, 2021, 2022, 2023, 2024];
  const colors = ["#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd"];

  const traces = years.map((year, i) => {
    // For simplicity, assign each program to a random year if no column provided
    const subset = data.filter((_, idx) => idx % 5 === i);
    return {
      x: subset.map(d => d["Average Enrollment"]),
      y: subset.map(d => d["Average Employability"]),
      text: subset.map(d => 
        `Program: ${d["PROGRAM"]}<br>Enrollment: ${d["Average Enrollment"]}%<br>Employability: ${d["Average Employability"]}%<br>Year: ${year}`
      ),
      mode: "markers",
      type: "scatter",
      name: `${year}`,
      marker: {
        size: 14,
        opacity: 0.8,
        color: colors[i],
        line: { width: 1, color: "#333" }
      },
      hovertemplate: "<b>%{text}</b><extra></extra>"
    };
  });

  Plotly.newPlot("chart1", traces, {
    title: "Enrollment vs Employability by Year (2020–2024)",
    xaxis: { title: "Average Enrollment (%)" },
    yaxis: { title: "Average Employability (%)" },
    plot_bgcolor: "#fff",
    paper_bgcolor: "#fff",
    legend: { title: { text: "Year (Color Reference)" } }
  });

  // === 2️⃣ Best & Worst Courses ===
  const minEnroll = data.reduce((a, b) => (a["Average Enrollment"] < b["Average Enrollment"] ? a : b));
  const maxEnroll = data.reduce((a, b) => (a["Average Enrollment"] > b["Average Enrollment"] ? a : b));
  const minEmploy = data.reduce((a, b) => (a["Average Employability"] < b["Average Employability"] ? a : b));
  const maxEmploy = data.reduce((a, b) => (a["Average Employability"] > b["Average Employability"] ? a : b));

  const trace2 = {
    x: [
      minEnroll["PROGRAM"],
      maxEnroll["PROGRAM"],
      minEmploy["PROGRAM"],
      maxEmploy["PROGRAM"]
    ],
    y: [
      minEnroll["Average Enrollment"],
      maxEnroll["Average Enrollment"],
      minEmploy["Average Employability"],
      maxEmploy["Average Employability"]
    ],
    text: [
      "Lowest Enrollment",
      "Highest Enrollment",
      "Lowest Employability",
      "Highest Employability"
    ],
    type: "bar",
    marker: { color: ["#1f77b4", "#2ca02c", "#d62728", "#ff7f0e"] },
    hovertemplate: "<b>%{x}</b><br>%{text}<br>Value: %{y}%<extra></extra>"
  };

  Plotly.newPlot("chart2", [trace2], {
    title: "Best & Worst Courses (Average 2020–2024)",
    yaxis: { title: "Percentage (%)" },
    xaxis: { title: "Program" },
    plot_bgcolor: "#fff",
    paper_bgcolor: "#fff"
  });

  // Stats summary
  document.getElementById("stats").innerHTML = `
    <span class="highlight">📘 Lowest Enrollment:</span> ${minEnroll["PROGRAM"]} (${minEnroll["Average Enrollment"]}%)<br>
    <span class="highlight">📗 Highest Enrollment:</span> ${maxEnroll["PROGRAM"]} (${maxEnroll["Average Enrollment"]}%)<br>
    <span class="highlight">📕 Lowest Employability:</span> ${minEmploy["PROGRAM"]} (${minEmploy["Average Employability"]}%)<br>
    <span class="highlight">📙 Highest Employability:</span> ${maxEmploy["PROGRAM"]} (${maxEmploy["Average Employability"]}%)
  `;

  // === 3️⃣ Overview Summary ===
  const avgEnroll = data.reduce((sum, d) => sum + d["Average Enrollment"], 0) / data.length;
  const avgEmploy = data.reduce((sum, d) => sum + d["Average Employability"], 0) / data.length;

  const trace3 = {
    x: ["Average Enrollment", "Average Employability"],
    y: [avgEnroll, avgEmploy],
    type: "bar",
    marker: { color: ["#00539C", "#FF7F0E"] },
    text: [`${avgEnroll.toFixed(2)}%`, `${avgEmploy.toFixed(2)}%`],
    textposition: "auto"
  };

  Plotly.newPlot("chart3", [trace3], {
    title: "Overall Averages (2020–2024)",
    yaxis: { title: "Percentage (%)", range: [0, 100] },
    plot_bgcolor: "#fff",
    paper_bgcolor: "#fff"
  });
});
</script>

</body>
</html>
